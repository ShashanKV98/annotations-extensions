(function(we,he){typeof exports=="object"&&typeof module<"u"?he(exports):typeof define=="function"&&define.amd?define(["exports"],he):(we=typeof globalThis<"u"?globalThis:we||self,he(we.SelectorPack={}))})(this,function(we){"use strict";function he(){}function Bt(e,t){for(const n in t)e[n]=t[n];return e}function lt(e){return e()}function at(){return Object.create(null)}function de(e){e.forEach(lt)}function Q(e){return typeof e=="function"}function ze(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ft(e){return Object.keys(e).length===0}function Yt(e,t,n,o){if(e){const r=ft(e,t,n,o);return e[0](r)}}function ft(e,t,n,o){return e[1]&&o?Bt(n.ctx.slice(),e[1](o(t))):n.ctx}function Nt(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const l=[],a=Math.max(t.dirty.length,r.length);for(let u=0;u<a;u+=1)l[u]=t.dirty[u]|r[u];return l}return t.dirty|r}return t.dirty}function jt(e,t,n,o,r,l){if(r){const a=ft(t,n,o,l);e.p(a,r)}}function Xt(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function U(e,t,n){e.insertBefore(t,n||null)}function Y(e){e.parentNode&&e.parentNode.removeChild(e)}function $t(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function C(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ut(e){return document.createTextNode(e)}function x(){return ut(" ")}function Ut(){return ut("")}function Z(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function d(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Dt(e){return Array.from(e.childNodes)}function zt(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}let ve;function He(e){ve=e}function Kt(){if(!ve)throw new Error("Function called outside component initialization");return ve}function Vt(){const e=Kt();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const l=zt(t,n,{cancelable:o});return r.slice().forEach(a=>{a.call(e,l)}),!l.defaultPrevented}return!0}}function Ee(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Te=[],ct=[];let Oe=[];const ht=[],qt=Promise.resolve();let Ke=!1;function Wt(){Ke||(Ke=!0,qt.then(dt))}function Ve(e){Oe.push(e)}const qe=new Set;let be=0;function dt(){if(be!==0)return;const e=ve;do{try{for(;be<Te.length;){const t=Te[be];be++,He(t),Jt(t.$$)}}catch(t){throw Te.length=0,be=0,t}for(He(null),Te.length=0,be=0;ct.length;)ct.pop()();for(let t=0;t<Oe.length;t+=1){const n=Oe[t];qe.has(n)||(qe.add(n),n())}Oe.length=0}while(Te.length);for(;ht.length;)ht.pop()();Ke=!1,qe.clear(),He(e)}function Jt(e){if(e.fragment!==null){e.update(),de(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ve)}}function Qt(e){const t=[],n=[];Oe.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Oe=t}const Ne=new Set;let Zt;function je(e,t){e&&e.i&&(Ne.delete(e),e.i(t))}function We(e,t,n,o){if(e&&e.o){if(Ne.has(e))return;Ne.add(e),Zt.c.push(()=>{Ne.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function pt(e){e&&e.c()}function Je(e,t,n,o){const{fragment:r,after_update:l}=e.$$;r&&r.m(t,n),o||Ve(()=>{const a=e.$$.on_mount.map(lt).filter(Q);e.$$.on_destroy?e.$$.on_destroy.push(...a):de(a),e.$$.on_mount=[]}),l.forEach(Ve)}function Qe(e,t){const n=e.$$;n.fragment!==null&&(Qt(n.after_update),de(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ct(e,t){e.$$.dirty[0]===-1&&(Te.push(e),Wt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ze(e,t,n,o,r,l,a,u=[-1]){const f=ve;He(e);const m=e.$$={fragment:null,ctx:[],props:l,update:he,not_equal:r,bound:at(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:at(),dirty:u,skip_bound:!1,root:t.target||f.$$.root};a&&a(m.root);let w=!1;if(m.ctx=n?n(e,t.props||{},(y,h,...i)=>{const _=i.length?i[0]:h;return m.ctx&&r(m.ctx[y],m.ctx[y]=_)&&(!m.skip_bound&&m.bound[y]&&m.bound[y](_),w&&Ct(e,y)),h}):[],m.update(),w=!0,de(m.before_update),m.fragment=o?o(m.ctx):!1,t.target){if(t.hydrate){const y=Dt(t.target);m.fragment&&m.fragment.l(y),y.forEach(Y)}else m.fragment&&m.fragment.c();t.intro&&je(e.$$.fragment),Je(e,t.target,t.anchor,t.customElement),dt()}He(f)}class Ce{$destroy(){Qe(this,1),this.$destroy=he}$on(t,n){if(!Q(n))return he;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!Ft(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var ue=(e=>(e.ELLIPSE="ELLIPSE",e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(ue||{});const xe=(e,t)=>t,xt=e=>{let t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach(([l,a])=>{t=Math.min(t,l),n=Math.min(n,a),o=Math.max(o,l),r=Math.max(r,a)}),{minX:t,minY:n,maxX:o,maxY:r}},en={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:r,rx:l,ry:a}=e.geometry,u=0,f=Math.cos(u),m=Math.sin(u),w=t-o,y=n-r,h=f*w+m*y,i=m*w-f*y;return h*h/(l*l)+i*i/(a*a)<=1}};xe(ue.ELLIPSE,en);const tn={area:e=>{const{points:t}=e.geometry;let n=0,o=t.length-1;for(let r=0;r<t.length;r++)n+=(t[o][0]+t[r][0])*(t[o][1]-t[r][1]),o=r;return Math.abs(.5*n)},intersects:(e,t,n)=>{const{points:o}=e.geometry;let r=!1;for(let l=0,a=o.length-1;l<o.length;a=l++){const u=o[l][0],f=o[l][1],m=o[a][0],w=o[a][1];f>n!=w>n&&t<(m-u)*(n-f)/(w-f)+u&&(r=!r)}return r}};xe(ue.POLYGON,tn);const nn={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};xe(ue.RECTANGLE,nn);const on=[];for(let e=0;e<256;++e)on.push((e+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),""))();function mt(e,t,n){const o=e.slice();return o[11]=t[n],o[13]=n,o}function yt(e){let t,n,o,r,l;return{c(){t=C("rect"),d(t,"class","a9s-corner-handle"),d(t,"x",n=e[11][0]-e[3]/2),d(t,"y",o=e[11][1]-e[3]/2),d(t,"height",e[3]),d(t,"width",e[3])},m(a,u){U(a,t,u),r||(l=Z(t,"pointerdown",function(){Q(e[10](S(e[13])))&&e[10](S(e[13])).apply(this,arguments)}),r=!0)},p(a,u){e=a,u&24&&n!==(n=e[11][0]-e[3]/2)&&d(t,"x",n),u&24&&o!==(o=e[11][1]-e[3]/2)&&d(t,"y",o),u&8&&d(t,"height",e[3]),u&8&&d(t,"width",e[3])},d(a){a&&Y(t),r=!1,l()}}}function rn(e){let t,n,o,r,l,a,u,f,m,w,y=e[4].points,h=[];for(let i=0;i<y.length;i+=1)h[i]=yt(mt(e,y,i));return{c(){t=C("polygon"),r=x(),l=C("polygon"),u=x();for(let i=0;i<h.length;i+=1)h[i].c();f=Ut(),d(t,"class","a9s-outer"),d(t,"style",n=e[1]?"display:none;":void 0),d(t,"points",o=e[4].points.map(_t).join(" ")),d(l,"class","a9s-inner a9s-shape-handle"),d(l,"style",e[1]),d(l,"points",a=e[4].points.map(gt).join(" "))},m(i,_){U(i,t,_),U(i,r,_),U(i,l,_),U(i,u,_);for(let p=0;p<h.length;p+=1)h[p]&&h[p].m(i,_);U(i,f,_),m||(w=[Z(t,"pointerdown",function(){Q(e[10](S.SHAPE))&&e[10](S.SHAPE).apply(this,arguments)}),Z(l,"pointerdown",function(){Q(e[10](S.SHAPE))&&e[10](S.SHAPE).apply(this,arguments)})],m=!0)},p(i,_){if(e=i,_&2&&n!==(n=e[1]?"display:none;":void 0)&&d(t,"style",n),_&16&&o!==(o=e[4].points.map(_t).join(" "))&&d(t,"points",o),_&2&&d(l,"style",e[1]),_&16&&a!==(a=e[4].points.map(gt).join(" "))&&d(l,"points",a),_&1048){y=e[4].points;let p;for(p=0;p<y.length;p+=1){const T=mt(e,y,p);h[p]?h[p].p(T,_):(h[p]=yt(T),h[p].c(),h[p].m(f.parentNode,f))}for(;p<h.length;p+=1)h[p].d(1);h.length=y.length}},d(i){i&&Y(t),i&&Y(r),i&&Y(l),i&&Y(u),$t(h,i),i&&Y(f),m=!1,de(w)}}}function sn(e){let t,n;return t=new Et({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[rn,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:e}}}),t.$on("change",e[7]),t.$on("grab",e[8]),t.$on("release",e[9]),{c(){pt(t.$$.fragment)},m(o,r){Je(t,o,r),n=!0},p(o,[r]){const l={};r&1&&(l.shape=o[0]),r&4&&(l.transform=o[2]),r&17434&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){n||(je(t.$$.fragment,o),n=!0)},o(o){We(t.$$.fragment,o),n=!1},d(o){Qe(t,o)}}}const _t=e=>e.join(","),gt=e=>e.join(",");function ln(e,t,n){let o,r,{shape:l}=t,{computedStyle:a=void 0}=t,{transform:u}=t,{viewportScale:f=1}=t;const m=(i,_,p)=>{let T;_===S.SHAPE?T=i.geometry.points.map(([L,b])=>[L+p[0],b+p[1]]):T=i.geometry.points.map(([L,b],A)=>_===S(A)?[L+p[0],b+p[1]]:[L,b]);const P=xt(T);return{...i,geometry:{points:T,bounds:P}}};function w(i){Ee.call(this,e,i)}function y(i){Ee.call(this,e,i)}function h(i){Ee.call(this,e,i)}return e.$$set=i=>{"shape"in i&&n(0,l=i.shape),"computedStyle"in i&&n(1,a=i.computedStyle),"transform"in i&&n(2,u=i.transform),"viewportScale"in i&&n(6,f=i.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=l.geometry),e.$$.dirty&64&&n(3,r=10/f)},[l,a,u,r,o,m,f,w,y,h]}class an extends Ce{constructor(t){super(),Ze(this,t,ln,sn,ze,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}function fn(e){let t,n,o,r,l,a,u,f,m,w,y,h,i,_,p,T,P,L,b,A,I,k,D,v,O,F,K,W,B,R,M,te,pe,N,ne,oe,me,j,re,se,ye,X,ie,le,_e,$,ae,fe,ge,Ye;return{c(){t=C("rect"),u=x(),f=C("rect"),i=x(),_=C("rect"),L=x(),b=C("rect"),D=x(),v=C("rect"),W=x(),B=C("rect"),pe=x(),N=C("rect"),me=x(),j=C("rect"),ye=x(),X=C("rect"),_e=x(),$=C("rect"),d(t,"class","a9s-outer"),d(t,"style",n=e[1]?"display:none;":void 0),d(t,"x",o=e[4].x),d(t,"y",r=e[4].y),d(t,"width",l=e[4].w),d(t,"height",a=e[4].h),d(f,"class","a9s-inner a9s-shape-handle"),d(f,"style",e[1]),d(f,"x",m=e[4].x),d(f,"y",w=e[4].y),d(f,"width",y=e[4].w),d(f,"height",h=e[4].h),d(_,"class","a9s-edge-handle a9s-edge-handle-top"),d(_,"x",p=e[4].x),d(_,"y",T=e[4].y),d(_,"height",1),d(_,"width",P=e[4].w),d(b,"class","a9s-edge-handle a9s-edge-handle-right"),d(b,"x",A=e[4].x+e[4].w),d(b,"y",I=e[4].y),d(b,"height",k=e[4].h),d(b,"width",1),d(v,"class","a9s-edge-handle a9s-edge-handle-bottom"),d(v,"x",O=e[4].x),d(v,"y",F=e[4].y+e[4].h),d(v,"height",1),d(v,"width",K=e[4].w),d(B,"class","a9s-edge-handle a9s-edge-handle-left"),d(B,"x",R=e[4].x),d(B,"y",M=e[4].y),d(B,"height",te=e[4].h),d(B,"width",1),d(N,"class","a9s-corner-handle a9s-corner-handle-topleft"),d(N,"x",ne=e[4].x-e[3]/2),d(N,"y",oe=e[4].y-e[3]/2),d(N,"height",e[3]),d(N,"width",e[3]),d(j,"class","a9s-corner-handle a9s-corner-handle-topright"),d(j,"x",re=e[4].x+e[4].w-e[3]/2),d(j,"y",se=e[4].y-e[3]/2),d(j,"height",e[3]),d(j,"width",e[3]),d(X,"class","a9s-corner-handle a9s-corner-handle-bottomright"),d(X,"x",ie=e[4].x+e[4].w-e[3]/2),d(X,"y",le=e[4].y+e[4].h-e[3]/2),d(X,"height",e[3]),d(X,"width",e[3]),d($,"class","a9s-corner-handle a9s-corner-handle-bottomleft"),d($,"x",ae=e[4].x-e[3]/2),d($,"y",fe=e[4].y+e[4].h-e[3]/2),d($,"height",e[3]),d($,"width",e[3])},m(g,c){U(g,t,c),U(g,u,c),U(g,f,c),U(g,i,c),U(g,_,c),U(g,L,c),U(g,b,c),U(g,D,c),U(g,v,c),U(g,W,c),U(g,B,c),U(g,pe,c),U(g,N,c),U(g,me,c),U(g,j,c),U(g,ye,c),U(g,X,c),U(g,_e,c),U(g,$,c),ge||(Ye=[Z(t,"pointerdown",function(){Q(e[10](S.SHAPE))&&e[10](S.SHAPE).apply(this,arguments)}),Z(f,"pointerdown",function(){Q(e[10](S.SHAPE))&&e[10](S.SHAPE).apply(this,arguments)}),Z(_,"pointerdown",function(){Q(e[10](S.TOP))&&e[10](S.TOP).apply(this,arguments)}),Z(b,"pointerdown",function(){Q(e[10](S.RIGHT))&&e[10](S.RIGHT).apply(this,arguments)}),Z(v,"pointerdown",function(){Q(e[10](S.BOTTOM))&&e[10](S.BOTTOM).apply(this,arguments)}),Z(B,"pointerdown",function(){Q(e[10](S.LEFT))&&e[10](S.LEFT).apply(this,arguments)}),Z(N,"pointerdown",function(){Q(e[10](S.TOP_LEFT))&&e[10](S.TOP_LEFT).apply(this,arguments)}),Z(j,"pointerdown",function(){Q(e[10](S.TOP_RIGHT))&&e[10](S.TOP_RIGHT).apply(this,arguments)}),Z(X,"pointerdown",function(){Q(e[10](S.BOTTOM_RIGHT))&&e[10](S.BOTTOM_RIGHT).apply(this,arguments)}),Z($,"pointerdown",function(){Q(e[10](S.BOTTOM_LEFT))&&e[10](S.BOTTOM_LEFT).apply(this,arguments)})],ge=!0)},p(g,c){e=g,c&2&&n!==(n=e[1]?"display:none;":void 0)&&d(t,"style",n),c&16&&o!==(o=e[4].x)&&d(t,"x",o),c&16&&r!==(r=e[4].y)&&d(t,"y",r),c&16&&l!==(l=e[4].w)&&d(t,"width",l),c&16&&a!==(a=e[4].h)&&d(t,"height",a),c&2&&d(f,"style",e[1]),c&16&&m!==(m=e[4].x)&&d(f,"x",m),c&16&&w!==(w=e[4].y)&&d(f,"y",w),c&16&&y!==(y=e[4].w)&&d(f,"width",y),c&16&&h!==(h=e[4].h)&&d(f,"height",h),c&16&&p!==(p=e[4].x)&&d(_,"x",p),c&16&&T!==(T=e[4].y)&&d(_,"y",T),c&16&&P!==(P=e[4].w)&&d(_,"width",P),c&16&&A!==(A=e[4].x+e[4].w)&&d(b,"x",A),c&16&&I!==(I=e[4].y)&&d(b,"y",I),c&16&&k!==(k=e[4].h)&&d(b,"height",k),c&16&&O!==(O=e[4].x)&&d(v,"x",O),c&16&&F!==(F=e[4].y+e[4].h)&&d(v,"y",F),c&16&&K!==(K=e[4].w)&&d(v,"width",K),c&16&&R!==(R=e[4].x)&&d(B,"x",R),c&16&&M!==(M=e[4].y)&&d(B,"y",M),c&16&&te!==(te=e[4].h)&&d(B,"height",te),c&24&&ne!==(ne=e[4].x-e[3]/2)&&d(N,"x",ne),c&24&&oe!==(oe=e[4].y-e[3]/2)&&d(N,"y",oe),c&8&&d(N,"height",e[3]),c&8&&d(N,"width",e[3]),c&24&&re!==(re=e[4].x+e[4].w-e[3]/2)&&d(j,"x",re),c&24&&se!==(se=e[4].y-e[3]/2)&&d(j,"y",se),c&8&&d(j,"height",e[3]),c&8&&d(j,"width",e[3]),c&24&&ie!==(ie=e[4].x+e[4].w-e[3]/2)&&d(X,"x",ie),c&24&&le!==(le=e[4].y+e[4].h-e[3]/2)&&d(X,"y",le),c&8&&d(X,"height",e[3]),c&8&&d(X,"width",e[3]),c&24&&ae!==(ae=e[4].x-e[3]/2)&&d($,"x",ae),c&24&&fe!==(fe=e[4].y+e[4].h-e[3]/2)&&d($,"y",fe),c&8&&d($,"height",e[3]),c&8&&d($,"width",e[3])},d(g){g&&Y(t),g&&Y(u),g&&Y(f),g&&Y(i),g&&Y(_),g&&Y(L),g&&Y(b),g&&Y(D),g&&Y(v),g&&Y(W),g&&Y(B),g&&Y(pe),g&&Y(N),g&&Y(me),g&&Y(j),g&&Y(ye),g&&Y(X),g&&Y(_e),g&&Y($),ge=!1,de(Ye)}}}function un(e){let t,n;return t=new Et({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[fn,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:e}}}),t.$on("grab",e[7]),t.$on("change",e[8]),t.$on("release",e[9]),{c(){pt(t.$$.fragment)},m(o,r){Je(t,o,r),n=!0},p(o,[r]){const l={};r&1&&(l.shape=o[0]),r&4&&(l.transform=o[2]),r&3098&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){n||(je(t.$$.fragment,o),n=!0)},o(o){We(t.$$.fragment,o),n=!1},d(o){Qe(t,o)}}}function cn(e,t,n){let o,r,{shape:l}=t,{computedStyle:a=void 0}=t,{transform:u}=t,{viewportScale:f=1}=t;const m=(i,_,p)=>{const T=i.geometry.bounds;let[P,L]=[T.minX,T.minY],[b,A]=[T.maxX,T.maxY];const[I,k]=p;if(_===S.SHAPE)P+=I,b+=I,L+=k,A+=k;else{switch(_){case S.TOP:case S.TOP_LEFT:case S.TOP_RIGHT:{L+=k;break}case S.BOTTOM:case S.BOTTOM_LEFT:case S.BOTTOM_RIGHT:{A+=k;break}}switch(_){case S.LEFT:case S.TOP_LEFT:case S.BOTTOM_LEFT:{P+=I;break}case S.RIGHT:case S.TOP_RIGHT:case S.BOTTOM_RIGHT:{b+=I;break}}}const D=Math.min(P,b),v=Math.min(L,A),O=Math.abs(b-P),F=Math.abs(A-L);return{...i,geometry:{x:D,y:v,w:O,h:F,bounds:{minX:D,minY:v,maxX:D+O,maxY:v+F}}}};function w(i){Ee.call(this,e,i)}function y(i){Ee.call(this,e,i)}function h(i){Ee.call(this,e,i)}return e.$$set=i=>{"shape"in i&&n(0,l=i.shape),"computedStyle"in i&&n(1,a=i.computedStyle),"transform"in i&&n(2,u=i.transform),"viewportScale"in i&&n(6,f=i.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=l.geometry),e.$$.dirty&64&&n(3,r=10/f)},[l,a,u,r,o,m,f,w,y,h]}class hn extends Ce{constructor(t){super(),Ze(this,t,cn,un,ze,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}ue.RECTANGLE,ue.POLYGON;const S=e=>`HANDLE-${e}`;S.SHAPE="SHAPE",S.TOP="TOP",S.RIGHT="RIGHT",S.BOTTOM="BOTTOM",S.LEFT="LEFT",S.TOP_LEFT="TOP_LEFT",S.TOP_RIGHT="TOP_RIGHT",S.BOTTOM_RIGHT="BOTTOM_RIGHT",S.BOTTOM_LEFT="BOTTOM_LEFT";const dn=e=>({}),wt=e=>({grab:e[0]});function pn(e){let t,n,o,r;const l=e[7].default,a=Yt(l,e,e[6],wt);return{c(){t=C("g"),a&&a.c(),d(t,"class","a9s-annotation selected")},m(u,f){U(u,t,f),a&&a.m(t,null),n=!0,o||(r=[Z(t,"pointerup",e[2]),Z(t,"pointermove",e[1])],o=!0)},p(u,[f]){a&&a.p&&(!n||f&64)&&jt(a,l,u,u[6],n?Nt(l,u[6],f,dn):Xt(u[6]),wt)},i(u){n||(je(a,u),n=!0)},o(u){We(a,u),n=!1},d(u){u&&Y(t),a&&a.d(u),o=!1,de(r)}}}function mn(e,t,n){let{$$slots:o={},$$scope:r}=t;const l=Vt();let{shape:a}=t,{editor:u}=t,{transform:f}=t,m=null,w,y=null;const h=p=>T=>{m=p,w=f.elementToImage(T.offsetX,T.offsetY),y=a,T.target.setPointerCapture(T.pointerId),l("grab")},i=p=>{if(m){const[T,P]=f.elementToImage(p.offsetX,p.offsetY),L=[T-w[0],P-w[1]];n(3,a=u(y,m,L)),l("change",a)}},_=p=>{p.target.releasePointerCapture(p.pointerId),m=null,y=a,l("release")};return e.$$set=p=>{"shape"in p&&n(3,a=p.shape),"editor"in p&&n(4,u=p.editor),"transform"in p&&n(5,f=p.transform),"$$scope"in p&&n(6,r=p.$$scope)},[h,i,_,a,u,f,r,o]}class Et extends Ce{constructor(t){super(),Ze(this,t,mn,pn,ze,{shape:3,editor:4,transform:5})}}function Ie(){}function yn(e,t){for(const n in t)e[n]=t[n];return e}function Tt(e){return e()}function Ot(){return Object.create(null)}function ce(e){e.forEach(Tt)}function V(e){return typeof e=="function"}function Ge(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function _n(e){return Object.keys(e).length===0}function gn(e,t,n,o){if(e){const r=bt(e,t,n,o);return e[0](r)}}function bt(e,t,n,o){return e[1]&&o?yn(n.ctx.slice(),e[1](o(t))):n.ctx}function wn(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const l=[],a=Math.max(t.dirty.length,r.length);for(let u=0;u<a;u+=1)l[u]=t.dirty[u]|r[u];return l}return t.dirty|r}return t.dirty}function En(e,t,n,o,r,l){if(r){const a=bt(t,n,o,l);e.p(a,r)}}function Tn(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function G(e,t,n){e.insertBefore(t,n||null)}function H(e){e.parentNode&&e.parentNode.removeChild(e)}function On(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function z(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Pt(e){return document.createTextNode(e)}function J(){return Pt(" ")}function bn(){return Pt("")}function q(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function s(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Pn(e){return Array.from(e.childNodes)}function Sn(e,t,{bubbles:n=!1,cancelable:o=!1}={}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,n,o,t),r}let Re;function Ae(e){Re=e}function St(){if(!Re)throw new Error("Function called outside component initialization");return Re}function Mn(e){St().$$.on_mount.push(e)}function Mt(){const e=St();return(t,n,{cancelable:o=!1}={})=>{const r=e.$$.callbacks[t];if(r){const l=Sn(t,n,{cancelable:o});return r.slice().forEach(a=>{a.call(e,l)}),!l.defaultPrevented}return!0}}function ee(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(o=>o.call(this,t))}const Pe=[],et=[];let Se=[];const Lt=[],Ln=Promise.resolve();let tt=!1;function vn(){tt||(tt=!0,Ln.then(vt))}function nt(e){Se.push(e)}const ot=new Set;let Me=0;function vt(){if(Me!==0)return;const e=Re;do{try{for(;Me<Pe.length;){const t=Pe[Me];Me++,Ae(t),Hn(t.$$)}}catch(t){throw Pe.length=0,Me=0,t}for(Ae(null),Pe.length=0,Me=0;et.length;)et.pop()();for(let t=0;t<Se.length;t+=1){const n=Se[t];ot.has(n)||(ot.add(n),n())}Se.length=0}while(Pe.length);for(;Lt.length;)Lt.pop()();tt=!1,ot.clear(),Ae(e)}function Hn(e){if(e.fragment!==null){e.update(),ce(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(nt)}}function In(e){const t=[],n=[];Se.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Se=t}const Xe=new Set;let Gn;function ke(e,t){e&&e.i&&(Xe.delete(e),e.i(t))}function $e(e,t,n,o){if(e&&e.o){if(Xe.has(e))return;Xe.add(e),Gn.c.push(()=>{Xe.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function rt(e){e&&e.c()}function Ue(e,t,n,o){const{fragment:r,after_update:l}=e.$$;r&&r.m(t,n),o||nt(()=>{const a=e.$$.on_mount.map(Tt).filter(V);e.$$.on_destroy?e.$$.on_destroy.push(...a):ce(a),e.$$.on_mount=[]}),l.forEach(nt)}function De(e,t){const n=e.$$;n.fragment!==null&&(In(n.after_update),ce(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Rn(e,t){e.$$.dirty[0]===-1&&(Pe.push(e),vn(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Be(e,t,n,o,r,l,a,u=[-1]){const f=Re;Ae(e);const m=e.$$={fragment:null,ctx:[],props:l,update:Ie,not_equal:r,bound:Ot(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:Ot(),dirty:u,skip_bound:!1,root:t.target||f.$$.root};a&&a(m.root);let w=!1;if(m.ctx=n?n(e,t.props||{},(y,h,...i)=>{const _=i.length?i[0]:h;return m.ctx&&r(m.ctx[y],m.ctx[y]=_)&&(!m.skip_bound&&m.bound[y]&&m.bound[y](_),w&&Rn(e,y)),h}):[],m.update(),w=!0,ce(m.before_update),m.fragment=o?o(m.ctx):!1,t.target){if(t.hydrate){const y=Pn(t.target);m.fragment&&m.fragment.l(y),y.forEach(H)}else m.fragment&&m.fragment.c();t.intro&&ke(e.$$.fragment),Ue(e,t.target,t.anchor,t.customElement),vt()}Ae(f)}class Fe{$destroy(){De(this,1),this.$destroy=Ie}$on(t,n){if(!V(n))return Ie;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!_n(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var Le=(e=>(e.ELLIPSE="ELLIPSE",e.POLYGON="POLYGON",e.RECTANGLE="RECTANGLE",e))(Le||{});const st=(e,t)=>t,An=e=>{let t=1/0,n=1/0,o=-1/0,r=-1/0;return e.forEach(([l,a])=>{t=Math.min(t,l),n=Math.min(n,a),o=Math.max(o,l),r=Math.max(r,a)}),{minX:t,minY:n,maxX:o,maxY:r}},kn={area:e=>Math.PI*e.geometry.rx*e.geometry.ry,intersects:(e,t,n)=>{const{cx:o,cy:r,rx:l,ry:a}=e.geometry,u=0,f=Math.cos(u),m=Math.sin(u),w=t-o,y=n-r,h=f*w+m*y,i=m*w-f*y;return h*h/(l*l)+i*i/(a*a)<=1}};st(Le.ELLIPSE,kn);const Bn={area:e=>{const{points:t}=e.geometry;let n=0,o=t.length-1;for(let r=0;r<t.length;r++)n+=(t[o][0]+t[r][0])*(t[o][1]-t[r][1]),o=r;return Math.abs(.5*n)},intersects:(e,t,n)=>{const{points:o}=e.geometry;let r=!1;for(let l=0,a=o.length-1;l<o.length;a=l++){const u=o[l][0],f=o[l][1],m=o[a][0],w=o[a][1];f>n!=w>n&&t<(m-u)*(n-f)/(w-f)+u&&(r=!r)}return r}};st(Le.POLYGON,Bn);const Fn={area:e=>e.geometry.w*e.geometry.h,intersects:(e,t,n)=>t>=e.geometry.x&&t<=e.geometry.x+e.geometry.w&&n>=e.geometry.y&&n<=e.geometry.y+e.geometry.h};st(Le.RECTANGLE,Fn),((e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),""))();function Ht(e,t,n){const o=e.slice();return o[11]=t[n],o[13]=n,o}function It(e){let t,n,o,r,l;return{c(){t=z("rect"),s(t,"class","a9s-corner-handle"),s(t,"x",n=e[11][0]-e[3]/2),s(t,"y",o=e[11][1]-e[3]/2),s(t,"height",e[3]),s(t,"width",e[3])},m(a,u){G(a,t,u),r||(l=q(t,"pointerdown",function(){V(e[10](E(e[13])))&&e[10](E(e[13])).apply(this,arguments)}),r=!0)},p(a,u){e=a,u&24&&n!==(n=e[11][0]-e[3]/2)&&s(t,"x",n),u&24&&o!==(o=e[11][1]-e[3]/2)&&s(t,"y",o),u&8&&s(t,"height",e[3]),u&8&&s(t,"width",e[3])},d(a){a&&H(t),r=!1,l()}}}function Yn(e){let t,n,o,r,l,a,u,f,m,w,y=e[4].points,h=[];for(let i=0;i<y.length;i+=1)h[i]=It(Ht(e,y,i));return{c(){t=z("polygon"),r=J(),l=z("polygon"),u=J();for(let i=0;i<h.length;i+=1)h[i].c();f=bn(),s(t,"class","a9s-outer"),s(t,"style",n=e[1]?"display:none;":void 0),s(t,"points",o=e[4].points.map(Gt).join(" ")),s(l,"class","a9s-inner a9s-shape-handle"),s(l,"style",e[1]),s(l,"points",a=e[4].points.map(Rt).join(" "))},m(i,_){G(i,t,_),G(i,r,_),G(i,l,_),G(i,u,_);for(let p=0;p<h.length;p+=1)h[p]&&h[p].m(i,_);G(i,f,_),m||(w=[q(t,"pointerdown",function(){V(e[10](E.SHAPE))&&e[10](E.SHAPE).apply(this,arguments)}),q(l,"pointerdown",function(){V(e[10](E.SHAPE))&&e[10](E.SHAPE).apply(this,arguments)})],m=!0)},p(i,_){if(e=i,_&2&&n!==(n=e[1]?"display:none;":void 0)&&s(t,"style",n),_&16&&o!==(o=e[4].points.map(Gt).join(" "))&&s(t,"points",o),_&2&&s(l,"style",e[1]),_&16&&a!==(a=e[4].points.map(Rt).join(" "))&&s(l,"points",a),_&1048){y=e[4].points;let p;for(p=0;p<y.length;p+=1){const T=Ht(e,y,p);h[p]?h[p].p(T,_):(h[p]=It(T),h[p].c(),h[p].m(f.parentNode,f))}for(;p<h.length;p+=1)h[p].d(1);h.length=y.length}},d(i){i&&H(t),i&&H(r),i&&H(l),i&&H(u),On(h,i),i&&H(f),m=!1,ce(w)}}}function Nn(e){let t,n;return t=new it({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[Yn,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:e}}}),t.$on("change",e[7]),t.$on("grab",e[8]),t.$on("release",e[9]),{c(){rt(t.$$.fragment)},m(o,r){Ue(t,o,r),n=!0},p(o,[r]){const l={};r&1&&(l.shape=o[0]),r&4&&(l.transform=o[2]),r&17434&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){n||(ke(t.$$.fragment,o),n=!0)},o(o){$e(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}const Gt=e=>e.join(","),Rt=e=>e.join(",");function jn(e,t,n){let o,r,{shape:l}=t,{computedStyle:a=void 0}=t,{transform:u}=t,{viewportScale:f=1}=t;const m=(i,_,p)=>{let T;_===E.SHAPE?T=i.geometry.points.map(([L,b])=>[L+p[0],b+p[1]]):T=i.geometry.points.map(([L,b],A)=>_===E(A)?[L+p[0],b+p[1]]:[L,b]);const P=An(T);return{...i,geometry:{points:T,bounds:P}}};function w(i){ee.call(this,e,i)}function y(i){ee.call(this,e,i)}function h(i){ee.call(this,e,i)}return e.$$set=i=>{"shape"in i&&n(0,l=i.shape),"computedStyle"in i&&n(1,a=i.computedStyle),"transform"in i&&n(2,u=i.transform),"viewportScale"in i&&n(6,f=i.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=l.geometry),e.$$.dirty&64&&n(3,r=10/f)},[l,a,u,r,o,m,f,w,y,h]}class Xn extends Fe{constructor(t){super(),Be(this,t,jn,Nn,Ge,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}function $n(e){let t,n,o,r,l,a,u,f,m,w,y,h,i,_,p,T,P,L,b,A,I,k,D,v,O,F,K,W,B,R,M,te,pe,N,ne,oe,me,j,re,se,ye,X,ie,le,_e,$,ae,fe,ge,Ye;return{c(){t=z("rect"),u=J(),f=z("rect"),i=J(),_=z("rect"),L=J(),b=z("rect"),D=J(),v=z("rect"),W=J(),B=z("rect"),pe=J(),N=z("rect"),me=J(),j=z("rect"),ye=J(),X=z("rect"),_e=J(),$=z("rect"),s(t,"class","a9s-outer"),s(t,"style",n=e[1]?"display:none;":void 0),s(t,"x",o=e[4].x),s(t,"y",r=e[4].y),s(t,"width",l=e[4].w),s(t,"height",a=e[4].h),s(f,"class","a9s-inner a9s-shape-handle"),s(f,"style",e[1]),s(f,"x",m=e[4].x),s(f,"y",w=e[4].y),s(f,"width",y=e[4].w),s(f,"height",h=e[4].h),s(_,"class","a9s-edge-handle a9s-edge-handle-top"),s(_,"x",p=e[4].x),s(_,"y",T=e[4].y),s(_,"height",1),s(_,"width",P=e[4].w),s(b,"class","a9s-edge-handle a9s-edge-handle-right"),s(b,"x",A=e[4].x+e[4].w),s(b,"y",I=e[4].y),s(b,"height",k=e[4].h),s(b,"width",1),s(v,"class","a9s-edge-handle a9s-edge-handle-bottom"),s(v,"x",O=e[4].x),s(v,"y",F=e[4].y+e[4].h),s(v,"height",1),s(v,"width",K=e[4].w),s(B,"class","a9s-edge-handle a9s-edge-handle-left"),s(B,"x",R=e[4].x),s(B,"y",M=e[4].y),s(B,"height",te=e[4].h),s(B,"width",1),s(N,"class","a9s-corner-handle a9s-corner-handle-topleft"),s(N,"x",ne=e[4].x-e[3]/2),s(N,"y",oe=e[4].y-e[3]/2),s(N,"height",e[3]),s(N,"width",e[3]),s(j,"class","a9s-corner-handle a9s-corner-handle-topright"),s(j,"x",re=e[4].x+e[4].w-e[3]/2),s(j,"y",se=e[4].y-e[3]/2),s(j,"height",e[3]),s(j,"width",e[3]),s(X,"class","a9s-corner-handle a9s-corner-handle-bottomright"),s(X,"x",ie=e[4].x+e[4].w-e[3]/2),s(X,"y",le=e[4].y+e[4].h-e[3]/2),s(X,"height",e[3]),s(X,"width",e[3]),s($,"class","a9s-corner-handle a9s-corner-handle-bottomleft"),s($,"x",ae=e[4].x-e[3]/2),s($,"y",fe=e[4].y+e[4].h-e[3]/2),s($,"height",e[3]),s($,"width",e[3])},m(g,c){G(g,t,c),G(g,u,c),G(g,f,c),G(g,i,c),G(g,_,c),G(g,L,c),G(g,b,c),G(g,D,c),G(g,v,c),G(g,W,c),G(g,B,c),G(g,pe,c),G(g,N,c),G(g,me,c),G(g,j,c),G(g,ye,c),G(g,X,c),G(g,_e,c),G(g,$,c),ge||(Ye=[q(t,"pointerdown",function(){V(e[10](E.SHAPE))&&e[10](E.SHAPE).apply(this,arguments)}),q(f,"pointerdown",function(){V(e[10](E.SHAPE))&&e[10](E.SHAPE).apply(this,arguments)}),q(_,"pointerdown",function(){V(e[10](E.TOP))&&e[10](E.TOP).apply(this,arguments)}),q(b,"pointerdown",function(){V(e[10](E.RIGHT))&&e[10](E.RIGHT).apply(this,arguments)}),q(v,"pointerdown",function(){V(e[10](E.BOTTOM))&&e[10](E.BOTTOM).apply(this,arguments)}),q(B,"pointerdown",function(){V(e[10](E.LEFT))&&e[10](E.LEFT).apply(this,arguments)}),q(N,"pointerdown",function(){V(e[10](E.TOP_LEFT))&&e[10](E.TOP_LEFT).apply(this,arguments)}),q(j,"pointerdown",function(){V(e[10](E.TOP_RIGHT))&&e[10](E.TOP_RIGHT).apply(this,arguments)}),q(X,"pointerdown",function(){V(e[10](E.BOTTOM_RIGHT))&&e[10](E.BOTTOM_RIGHT).apply(this,arguments)}),q($,"pointerdown",function(){V(e[10](E.BOTTOM_LEFT))&&e[10](E.BOTTOM_LEFT).apply(this,arguments)})],ge=!0)},p(g,c){e=g,c&2&&n!==(n=e[1]?"display:none;":void 0)&&s(t,"style",n),c&16&&o!==(o=e[4].x)&&s(t,"x",o),c&16&&r!==(r=e[4].y)&&s(t,"y",r),c&16&&l!==(l=e[4].w)&&s(t,"width",l),c&16&&a!==(a=e[4].h)&&s(t,"height",a),c&2&&s(f,"style",e[1]),c&16&&m!==(m=e[4].x)&&s(f,"x",m),c&16&&w!==(w=e[4].y)&&s(f,"y",w),c&16&&y!==(y=e[4].w)&&s(f,"width",y),c&16&&h!==(h=e[4].h)&&s(f,"height",h),c&16&&p!==(p=e[4].x)&&s(_,"x",p),c&16&&T!==(T=e[4].y)&&s(_,"y",T),c&16&&P!==(P=e[4].w)&&s(_,"width",P),c&16&&A!==(A=e[4].x+e[4].w)&&s(b,"x",A),c&16&&I!==(I=e[4].y)&&s(b,"y",I),c&16&&k!==(k=e[4].h)&&s(b,"height",k),c&16&&O!==(O=e[4].x)&&s(v,"x",O),c&16&&F!==(F=e[4].y+e[4].h)&&s(v,"y",F),c&16&&K!==(K=e[4].w)&&s(v,"width",K),c&16&&R!==(R=e[4].x)&&s(B,"x",R),c&16&&M!==(M=e[4].y)&&s(B,"y",M),c&16&&te!==(te=e[4].h)&&s(B,"height",te),c&24&&ne!==(ne=e[4].x-e[3]/2)&&s(N,"x",ne),c&24&&oe!==(oe=e[4].y-e[3]/2)&&s(N,"y",oe),c&8&&s(N,"height",e[3]),c&8&&s(N,"width",e[3]),c&24&&re!==(re=e[4].x+e[4].w-e[3]/2)&&s(j,"x",re),c&24&&se!==(se=e[4].y-e[3]/2)&&s(j,"y",se),c&8&&s(j,"height",e[3]),c&8&&s(j,"width",e[3]),c&24&&ie!==(ie=e[4].x+e[4].w-e[3]/2)&&s(X,"x",ie),c&24&&le!==(le=e[4].y+e[4].h-e[3]/2)&&s(X,"y",le),c&8&&s(X,"height",e[3]),c&8&&s(X,"width",e[3]),c&24&&ae!==(ae=e[4].x-e[3]/2)&&s($,"x",ae),c&24&&fe!==(fe=e[4].y+e[4].h-e[3]/2)&&s($,"y",fe),c&8&&s($,"height",e[3]),c&8&&s($,"width",e[3])},d(g){g&&H(t),g&&H(u),g&&H(f),g&&H(i),g&&H(_),g&&H(L),g&&H(b),g&&H(D),g&&H(v),g&&H(W),g&&H(B),g&&H(pe),g&&H(N),g&&H(me),g&&H(j),g&&H(ye),g&&H(X),g&&H(_e),g&&H($),ge=!1,ce(Ye)}}}function Un(e){let t,n;return t=new it({props:{shape:e[0],transform:e[2],editor:e[5],$$slots:{default:[$n,({grab:o})=>({10:o}),({grab:o})=>o?1024:0]},$$scope:{ctx:e}}}),t.$on("grab",e[7]),t.$on("change",e[8]),t.$on("release",e[9]),{c(){rt(t.$$.fragment)},m(o,r){Ue(t,o,r),n=!0},p(o,[r]){const l={};r&1&&(l.shape=o[0]),r&4&&(l.transform=o[2]),r&3098&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){n||(ke(t.$$.fragment,o),n=!0)},o(o){$e(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function Dn(e,t,n){let o,r,{shape:l}=t,{computedStyle:a=void 0}=t,{transform:u}=t,{viewportScale:f=1}=t;const m=(i,_,p)=>{const T=i.geometry.bounds;let[P,L]=[T.minX,T.minY],[b,A]=[T.maxX,T.maxY];const[I,k]=p;if(_===E.SHAPE)P+=I,b+=I,L+=k,A+=k;else{switch(_){case E.TOP:case E.TOP_LEFT:case E.TOP_RIGHT:{L+=k;break}case E.BOTTOM:case E.BOTTOM_LEFT:case E.BOTTOM_RIGHT:{A+=k;break}}switch(_){case E.LEFT:case E.TOP_LEFT:case E.BOTTOM_LEFT:{P+=I;break}case E.RIGHT:case E.TOP_RIGHT:case E.BOTTOM_RIGHT:{b+=I;break}}}const D=Math.min(P,b),v=Math.min(L,A),O=Math.abs(b-P),F=Math.abs(A-L);return{...i,geometry:{x:D,y:v,w:O,h:F,bounds:{minX:D,minY:v,maxX:D+O,maxY:v+F}}}};function w(i){ee.call(this,e,i)}function y(i){ee.call(this,e,i)}function h(i){ee.call(this,e,i)}return e.$$set=i=>{"shape"in i&&n(0,l=i.shape),"computedStyle"in i&&n(1,a=i.computedStyle),"transform"in i&&n(2,u=i.transform),"viewportScale"in i&&n(6,f=i.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(4,o=l.geometry),e.$$.dirty&64&&n(3,r=10/f)},[l,a,u,r,o,m,f,w,y,h]}class zn extends Fe{constructor(t){super(),Be(this,t,Dn,Un,Ge,{shape:0,computedStyle:1,transform:2,viewportScale:6})}}Le.RECTANGLE,Le.POLYGON;const E=e=>`HANDLE-${e}`;E.SHAPE="SHAPE",E.TOP="TOP",E.RIGHT="RIGHT",E.BOTTOM="BOTTOM",E.LEFT="LEFT",E.TOP_LEFT="TOP_LEFT",E.TOP_RIGHT="TOP_RIGHT",E.BOTTOM_RIGHT="BOTTOM_RIGHT",E.BOTTOM_LEFT="BOTTOM_LEFT";const Kn=e=>({}),At=e=>({grab:e[0]});function Vn(e){let t,n,o,r;const l=e[7].default,a=gn(l,e,e[6],At);return{c(){t=z("g"),a&&a.c(),s(t,"class","a9s-annotation selected")},m(u,f){G(u,t,f),a&&a.m(t,null),n=!0,o||(r=[q(t,"pointerup",e[2]),q(t,"pointermove",e[1])],o=!0)},p(u,[f]){a&&a.p&&(!n||f&64)&&En(a,l,u,u[6],n?wn(l,u[6],f,Kn):Tn(u[6]),At)},i(u){n||(ke(a,u),n=!0)},o(u){$e(a,u),n=!1},d(u){u&&H(t),a&&a.d(u),o=!1,ce(r)}}}function qn(e,t,n){let{$$slots:o={},$$scope:r}=t;const l=Mt();let{shape:a}=t,{editor:u}=t,{transform:f}=t,m=null,w,y=null;const h=p=>T=>{m=p,w=f.elementToImage(T.offsetX,T.offsetY),y=a,T.target.setPointerCapture(T.pointerId),l("grab")},i=p=>{if(m){const[T,P]=f.elementToImage(p.offsetX,p.offsetY),L=[T-w[0],P-w[1]];n(3,a=u(y,m,L)),l("change",a)}},_=p=>{p.target.releasePointerCapture(p.pointerId),m=null,y=a,l("release")};return e.$$set=p=>{"shape"in p&&n(3,a=p.shape),"editor"in p&&n(4,u=p.editor),"transform"in p&&n(5,f=p.transform),"$$scope"in p&&n(6,r=p.$$scope)},[h,i,_,a,u,f,r,o]}class it extends Fe{constructor(t){super(),Be(this,t,qn,Vn,Ge,{shape:3,editor:4,transform:5})}}const ro="",so="",io="";function Wn(e){let t,n,o,r,l,a,u,f,m,w,y,h,i,_,p,T,P,L,b,A,I,k,D,v,O,F,K,W,B;return{c(){t=z("ellipse"),a=J(),u=z("ellipse"),h=J(),i=z("rect"),T=J(),P=z("rect"),A=J(),I=z("rect"),v=J(),O=z("rect"),s(t,"class","a9s-outer"),s(t,"cx",n=e[3].cx),s(t,"cy",o=e[3].cy),s(t,"rx",r=e[3].rx),s(t,"ry",l=e[3].ry),s(u,"class","a9s-inner a9s-shape-handle"),s(u,"cx",f=e[3].cx),s(u,"cy",m=e[3].cy),s(u,"rx",w=e[3].rx),s(u,"ry",y=e[3].ry),s(i,"class","a9s-corner-handle a9s-corner-top"),s(i,"x",_=e[3].cx-e[2]/2),s(i,"y",p=e[3].cy-e[2]/2-e[3].ry),s(i,"height",e[2]),s(i,"width",e[2]),s(P,"class","a9s-corner-handle a9s-corner-handle-right"),s(P,"x",L=e[3].cx+e[3].rx-e[2]/2),s(P,"y",b=e[3].cy-e[2]/2),s(P,"height",e[2]),s(P,"width",e[2]),s(I,"class","a9s-corner-handle a9s-corner-handle-bottom"),s(I,"x",k=e[3].cx-e[2]/2),s(I,"y",D=e[3].cy+e[3].ry-e[2]/2),s(I,"height",e[2]),s(I,"width",e[2]),s(O,"class","a9s-corner-handle a9s-corner-handle-left"),s(O,"x",F=e[3].cx-e[3].rx-e[2]/2),s(O,"y",K=e[3].cy-e[2]/2),s(O,"height",e[2]),s(O,"width",e[2])},m(R,M){G(R,t,M),G(R,a,M),G(R,u,M),G(R,h,M),G(R,i,M),G(R,T,M),G(R,P,M),G(R,A,M),G(R,I,M),G(R,v,M),G(R,O,M),W||(B=[q(t,"pointerdown",function(){V(e[9](E.SHAPE))&&e[9](E.SHAPE).apply(this,arguments)}),q(u,"pointerdown",function(){V(e[9](E.SHAPE))&&e[9](E.SHAPE).apply(this,arguments)}),q(i,"pointerdown",function(){V(e[9](E.TOP))&&e[9](E.TOP).apply(this,arguments)}),q(P,"pointerdown",function(){V(e[9](E.RIGHT))&&e[9](E.RIGHT).apply(this,arguments)}),q(I,"pointerdown",function(){V(e[9](E.BOTTOM))&&e[9](E.BOTTOM).apply(this,arguments)}),q(O,"pointerdown",function(){V(e[9](E.LEFT))&&e[9](E.LEFT).apply(this,arguments)})],W=!0)},p(R,M){e=R,M&8&&n!==(n=e[3].cx)&&s(t,"cx",n),M&8&&o!==(o=e[3].cy)&&s(t,"cy",o),M&8&&r!==(r=e[3].rx)&&s(t,"rx",r),M&8&&l!==(l=e[3].ry)&&s(t,"ry",l),M&8&&f!==(f=e[3].cx)&&s(u,"cx",f),M&8&&m!==(m=e[3].cy)&&s(u,"cy",m),M&8&&w!==(w=e[3].rx)&&s(u,"rx",w),M&8&&y!==(y=e[3].ry)&&s(u,"ry",y),M&12&&_!==(_=e[3].cx-e[2]/2)&&s(i,"x",_),M&12&&p!==(p=e[3].cy-e[2]/2-e[3].ry)&&s(i,"y",p),M&4&&s(i,"height",e[2]),M&4&&s(i,"width",e[2]),M&12&&L!==(L=e[3].cx+e[3].rx-e[2]/2)&&s(P,"x",L),M&12&&b!==(b=e[3].cy-e[2]/2)&&s(P,"y",b),M&4&&s(P,"height",e[2]),M&4&&s(P,"width",e[2]),M&12&&k!==(k=e[3].cx-e[2]/2)&&s(I,"x",k),M&12&&D!==(D=e[3].cy+e[3].ry-e[2]/2)&&s(I,"y",D),M&4&&s(I,"height",e[2]),M&4&&s(I,"width",e[2]),M&12&&F!==(F=e[3].cx-e[3].rx-e[2]/2)&&s(O,"x",F),M&12&&K!==(K=e[3].cy-e[2]/2)&&s(O,"y",K),M&4&&s(O,"height",e[2]),M&4&&s(O,"width",e[2])},d(R){R&&H(t),R&&H(a),R&&H(u),R&&H(h),R&&H(i),R&&H(T),R&&H(P),R&&H(A),R&&H(I),R&&H(v),R&&H(O),W=!1,ce(B)}}}function Jn(e){let t,n;return t=new it({props:{shape:e[0],transform:e[1],editor:e[4],$$slots:{default:[Wn,({grab:o})=>({9:o}),({grab:o})=>o?512:0]},$$scope:{ctx:e}}}),t.$on("grab",e[6]),t.$on("change",e[7]),t.$on("release",e[8]),{c(){rt(t.$$.fragment)},m(o,r){Ue(t,o,r),n=!0},p(o,[r]){const l={};r&1&&(l.shape=o[0]),r&2&&(l.transform=o[1]),r&1548&&(l.$$scope={dirty:r,ctx:o}),t.$set(l)},i(o){n||(ke(t.$$.fragment,o),n=!0)},o(o){$e(t.$$.fragment,o),n=!1},d(o){De(t,o)}}}function Qn(e,t,n){let o,r,{shape:l}=t,{transform:a}=t,{viewportScale:u=1}=t;const f=(h,i,_)=>{const p=h.geometry.bounds;let[T,P]=[p.minX,p.minY],[L,b]=[p.maxX,p.maxY];const[A,I]=_;if(i===E.SHAPE)T+=A,L+=A,P+=I,b+=I;else switch(i){case E.TOP:{P+=I;break}case E.BOTTOM:{b+=I;break}case E.LEFT:{T+=A;break}case E.RIGHT:{L+=A;break}}const k=Math.min(T,L),D=Math.min(P,b),v=Math.abs(L-T),O=Math.abs(b-P),F=(T+L)/2,K=(P+b)/2,W=v/2,B=O/2;return{...h,geometry:{...h.geometry,cx:F,cy:K,rx:W,ry:B,bounds:{minX:k,minY:D,maxX:k+v,maxY:D+O}}}};function m(h){ee.call(this,e,h)}function w(h){ee.call(this,e,h)}function y(h){ee.call(this,e,h)}return e.$$set=h=>{"shape"in h&&n(0,l=h.shape),"transform"in h&&n(1,a=h.transform),"viewportScale"in h&&n(5,u=h.viewportScale)},e.$$.update=()=>{e.$$.dirty&1&&n(3,o=l.geometry),e.$$.dirty&32&&n(2,r=10/u)},[l,a,r,o,f,u,m,w,y]}class Zn extends Fe{constructor(t){super(),Be(this,t,Qn,Jn,Ge,{shape:0,transform:1,viewportScale:5})}}function kt(e){let t,n,o,r,l,a,u,f,m,w;return{c(){t=z("ellipse"),a=z("ellipse"),s(t,"class","a9s-outer"),s(t,"cx",n=e[2]+e[4]/2),s(t,"cy",o=e[3]+e[5]/2),s(t,"rx",r=e[4]/2),s(t,"ry",l=e[5]/2),s(a,"class","a9s-inner"),s(a,"cx",u=e[2]+e[4]/2),s(a,"cy",f=e[3]+e[5]/2),s(a,"rx",m=e[4]/2),s(a,"ry",w=e[5]/2)},m(y,h){G(y,t,h),G(y,a,h)},p(y,h){h&20&&n!==(n=y[2]+y[4]/2)&&s(t,"cx",n),h&40&&o!==(o=y[3]+y[5]/2)&&s(t,"cy",o),h&16&&r!==(r=y[4]/2)&&s(t,"rx",r),h&32&&l!==(l=y[5]/2)&&s(t,"ry",l),h&20&&u!==(u=y[2]+y[4]/2)&&s(a,"cx",u),h&40&&f!==(f=y[3]+y[5]/2)&&s(a,"cy",f),h&16&&m!==(m=y[4]/2)&&s(a,"rx",m),h&32&&w!==(w=y[5]/2)&&s(a,"ry",w)},d(y){y&&H(t),y&&H(a)}}}function Cn(e){let t,n=e[1]&&kt(e);return{c(){t=z("g"),n&&n.c(),s(t,"class","a9s-annotation a9s-rubberband")},m(o,r){G(o,t,r),n&&n.m(t,null),e[9](t)},p(o,[r]){o[1]?n?n.p(o,r):(n=kt(o),n.c(),n.m(t,null)):n&&(n.d(1),n=null)},i:Ie,o:Ie,d(o){o&&H(t),n&&n.d(),e[9](null)}}}function xn(e,t,n){const o=Mt();let{addEventListener:r}=t,{drawingMode:l}=t,{transform:a}=t,u,f,m,w,y,h,i,_=!1,p=!1,T,P;const L=O=>{T=performance.now(),l==="drag"&&(n(1,f=a.elementToImage(O.offsetX,O.offsetY)),m=f,n(2,w=f[0]),n(3,y=f[1]),n(4,h=1),n(5,i=1))},b=O=>{const F=O||P;if(f)if(m=a.elementToImage(F.offsetX,F.offsetY),p){const K=2*Math.abs(m[0]-f[0]),W=2*Math.abs(m[1]-f[1]);n(4,h=_?Math.max(K,W):K),n(5,i=_?h:W),n(2,w=Math.min(m[0],f[0]-h/2)),n(3,y=Math.min(m[1],f[1]-i/2))}else{const K=Math.abs(m[0]-f[0]),W=Math.abs(m[1]-f[1]);n(4,h=_?Math.max(K,W):K),n(5,i=_?h:W),n(2,w=Math.min(m[0],f[0])),n(3,y=Math.min(m[1],f[1]))}O&&(P=O)},A=O=>{l==="click"&&O.stopImmediatePropagation();const F=performance.now()-T;if(l==="click"){if(F>300)return;O.stopPropagation(),f?I():(n(1,f=a.elementToImage(O.offsetX,O.offsetY)),m=f,n(2,w=f[0]),n(3,y=f[1]),n(4,h=1),n(5,i=1))}else f&&(F>300||h*i>100?(O.stopPropagation(),I()):(n(1,f=null),m=null,P=void 0))},I=()=>{if(h*i>15){const O={type:ue.ELLIPSE,geometry:{bounds:{minX:w,minY:y,maxX:w+h,maxY:y+i},cx:w+h/2,cy:y+i/2,rx:h/2,ry:i/2}};o("create",O)}n(1,f=null),m=null,P=void 0},k=O=>{O.key==="Shift"&&(_=!0,b()),O.key==="Control"&&(p=!0,b())},D=O=>{O.key==="Shift"&&(_=!1,b()),O.key==="Control"&&(p=!1,b())};Mn(()=>(document.addEventListener("keyup",D),document.addEventListener("keydown",k),r("pointerdown",L),r("pointermove",b),r("pointerup",A),()=>{document.removeEventListener("keyup",D),document.removeEventListener("keydown",k)}));function v(O){et[O?"unshift":"push"](()=>{u=O,n(0,u)})}return e.$$set=O=>{"addEventListener"in O&&n(6,r=O.addEventListener),"drawingMode"in O&&n(7,l=O.drawingMode),"transform"in O&&n(8,a=O.transform)},[u,f,w,y,h,i,r,l,a,v]}class eo extends Fe{constructor(t){super(),Be(this,t,xn,Cn,Ge,{addEventListener:6,drawingMode:7,transform:8})}}const to=e=>{e.registerDrawingTool("ellipse",eo),e.registerShapeEditor(ue.ELLIPSE,Zn)};we.mountExtension=to,Object.defineProperty(we,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=annotorious-selector-pack.js.map
